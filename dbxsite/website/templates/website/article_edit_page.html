{% extends 'website/base.html' %}
{% block body_content %}
    <div class="container">
        <form role="form" method="post" action="{% url 'article:edit_action' %}" id="article-form">
            {% csrf_token %}
            <input type="hidden" name="article_id" value="{{ article.id | default:'0' }}"/>
            <div class="row">
                <div class="form-group">
                    <input title="title" type="text" name="title" class="form-control input-lg"
                           value="{{ article.title|default_if_none:'' }}" id="article-title"
                           placeholder="文章标题">
                </div>
            </div>
            <div class="row">
                <div class="dropdown">
                    <input type="hidden" name="editor" value="{{ editor }}">
                    <label for="select-editor">编辑器：</label>
                    <button class="btn btn-default dropdown-toggle" href="#" id="select-editor"
                            data-toggle="dropdown" style="margin-bottom: 10px">
                        {{ editor }}
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu" role="menu" aria-labelledby="select-editor">
                        <li role="presentation">
                            <a role="menuitem" href="{% url 'article:article_edit_page' article_id %}?editor=Markdown"
                               tabindex="-1">Markdown</a>
                        </li>
                        <li role="presentation">
                            <a role="menuitem" href="{% url 'article:article_edit_page' article_id %}?editor=Summernote"
                               tabindex="-1">Summernote</a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="row">
                {% if editor == 'Summernote' %}
                    <textarea style="display: none" name="content" title="content" id="content-area"></textarea>
                    <div class="form-group" id="article-editor">
                        {{ article.content|safe|linebreaks|default_if_none:'' }}
                    </div>
                {% elif editor == 'Markdown' %}
                    <div class="form-group" id="article-editor">
                    <textarea title="content" name="content" class="form-control" style="resize: none;"
                              rows="20" placeholder="在这里编辑文章内容"
                              id="article-content">{{ article.content|default_if_none:'' }}</textarea>
                    </div>
                {% endif %}
            </div>
            <div class="row">
                <div class="form-group">
                    <button class="btn btn-success btn-lg btn-block" type="button" id="submit-btn">提交</button>
                </div>
            </div>
        </form>
    </div>
    <script type="text/javascript">
        var editor_area = $('#article-editor');
        var editor = '{{ editor }}';
        console.log(editor);
        if (editor == 'Summernote') {
            editor_area.summernote({
                placeholder: '在这里编辑文章内容',
                height: 500,
                fontNames: ['Arial', 'Consolas', 'Comic Sans MS', 'Courier New', 'Microsoft YaHei'],
                lang: 'zh-CN',
                enterHtml: '<p></p>' // '<br>', '<p>&nbsp;</p>', '<p><br></p>', '<div><br></div>'
            });
        }

        $('#submit-btn').on('click', function () {
            var articleTitle = $('#article-title').val(),
                    articleContent = $('#article-content').val();
            if ($.trim(articleTitle) == '') {
                BootstrapDialog.show({
                    type: BootstrapDialog.TYPE_DANGER,
                    title: "错误",
                    message: "文章标题不能为空！",
                    buttons: [{
                        label: '关闭',
                        action: function (dialogItself) {
                            dialogItself.close();
                        }
                    }]
                });
                return;
            }
            else {
                if (editor == 'Summernote') {
                    $('#content-area').text(editor_area.summernote('code'));
                }
                $('#article-form').submit();
            }
        });
        $('.dropdown-toggle').dropdown();
    </script>
{% endblock %}